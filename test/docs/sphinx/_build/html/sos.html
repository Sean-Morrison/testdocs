<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Pipeline Dependencies" href="Dependencies.html" /><link rel="prev" title="Running a BOSS DRP Daily Run" href="daily.html" />

    <link rel="shortcut icon" href="_static/favicon_sdssv.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>SOS: The BOSS on Mountain Pipeline - IDLSPEC2D&#39;s Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=99aaee5e" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">IDLSPEC2D's Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/sdssv_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">IDLSPEC2D's Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">IDLspec2D: The SDSS BOSS Data Reduction Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="catchup.html">Running the BOSS DRP Catchup</a></li>
<li class="toctree-l1"><a class="reference internal" href="daily.html">Running the BOSS DRP Daily</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Son-of-spectro (SOS): The BOSS on Mountain Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dependencies.html">Pipeline Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc.html">Full Command Documention</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="son-of-spectro-sos-the-boss-on-mountain-pipeline">
<h1>Son-of-spectro (SOS): The BOSS on Mountain Pipeline<a class="headerlink" href="#son-of-spectro-sos-the-boss-on-mountain-pipeline" title="Permalink to this heading">#</a></h1>
<p>At APO (LCO) the log files are stored in sdss5-hub.apo.nmsu.edu/data/boss/sos/&lt;MJD&gt; (sdss5-hub.lco.cl/data/boss/sos/&lt;MJD&gt;) with the logs file stored in /home/sdss5/boss/sos/logs.</p>
<p>The sos systemctl process is currently started automatically at boot.</p>
<p>The python help for this command can be found with SOS -h.</p>
<section id="sos-as-a-systemctl-process">
<h2>SOS as a systemctl process<a class="headerlink" href="#sos-as-a-systemctl-process" title="Permalink to this heading">#</a></h2>
<p>SOS is designed to run as a pair of systemctl processes (1 for red and 1 for blue) at the observatories. They are controlled indepednetly, so that if one crashes it can be restared while leaving the other running. In sdss5 they are run by the sdss5 users on the sdss5-bhm machines at each observatory. To start/restart/stop each of these processes, they can be controlled via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="o">--</span><span class="n">user</span> <span class="n">start</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">stop</span> <span class="n">SOS</span>
<span class="n">systemctl</span> <span class="o">--</span><span class="n">user</span> <span class="n">start</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">stop</span> <span class="n">SOS_red</span>
</pre></div>
</div>
<p>or as a joint command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="o">--</span><span class="n">user</span> <span class="n">start</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">stop</span> <span class="n">SOS</span> <span class="n">SOS_red</span>
</pre></div>
</div>
<section id="backing-out-to-an-older-version">
<h3>Backing out to an Older Version<a class="headerlink" href="#backing-out-to-an-older-version" title="Permalink to this heading">#</a></h3>
<p>If errors in a recent update prevent SOS from functioning properly, older versions of SOS can be loaded instead. As the SOS version is managed by the idlspec2d modules on the mountains, this can be done by issuing the following commands as the sdss5 user on sdss5-bhm</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="o">--</span><span class="n">user</span> <span class="n">stop</span> <span class="n">SOS</span> <span class="n">SOS_red</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sdss5</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">modulefiles</span><span class="o">/</span><span class="n">idlspec2d</span>
<span class="n">unlink</span> <span class="n">default</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="n">v6_0_9</span>  <span class="n">default</span>
<span class="n">systemctl</span> <span class="o">--</span><span class="n">user</span> <span class="n">start</span> <span class="n">SOS</span> <span class="n">SOS_red</span>
</pre></div>
</div>
<p>where v6_0_9 can be replaced by the latest functional version installed.</p>
</section>
<section id="troubleshooting-sos">
<h3>Troubleshooting SOS<a class="headerlink" href="#troubleshooting-sos" title="Permalink to this heading">#</a></h3>
<p>The Son-of-Spectro (SOS) reduction has proven to be quite robust. However, if it appears to not be working one could check the following:</p>
<ul class="simple">
<li><p>Is the system process running? Log into “<a class="reference external" href="mailto:sdss5&#37;&#52;&#48;sdss5-bhm">sdss5<span>&#64;</span>sdss5-bhm</a>”, and issue <code class="code docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">--user</span> <span class="pre">status</span> <span class="pre">SOS</span> <span class="pre">SOS_red</span></code> command to check if both processes are still running.  If not then <code class="code docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">--user</span> <span class="pre">restart</span> <span class="pre">SOS</span> <span class="pre">SOS_red</span></code> (you can just to SOS or SOS_red if only 1 crashed). Then use the catchup commands to rerun any missed exposures and note in the night logs. If both processes are running, then just try the catchup command without restarting the processes (please note these exposures as well). If the reduction still fails then try emailing or slacking Sean Morrison</p></li>
<li><p>Are there old “lock” files sitting around? SOS generates “lock” files to prevent multiple processes from changing these files simultaneously. If any have been sitting around for several minutes or more, then something is wrong. You should delete the file ending with “.lock”. However, this could result in a corrupted “logfile*.fits”.</p></li>
</ul>
<p>The three places that could have a lockfile are</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">boss</span><span class="o">/</span><span class="n">sos</span><span class="o">/</span><span class="p">{</span><span class="n">mjd</span><span class="p">}</span><span class="o">/*.</span><span class="n">lock</span>
<span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">boss</span><span class="o">/</span><span class="n">sos</span><span class="o">/</span><span class="n">combined</span><span class="o">/*.</span><span class="n">lock</span>
<span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">boss</span><span class="o">/</span><span class="n">sos</span><span class="o">/</span><span class="p">{</span><span class="n">mjd</span><span class="p">}</span><span class="o">/</span><span class="n">trace</span><span class="o">/</span><span class="p">{</span><span class="n">mjd</span><span class="p">}</span><span class="o">/*.</span><span class="n">lock</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sdss5</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">sdsscore</span><span class="o">/</span><span class="n">main</span><span class="o">/*/</span><span class="n">sdHdrfix</span><span class="o">/*.</span><span class="n">lock</span>
</pre></div>
</div>
<p>It is normal for lock files to be there temporarily (for a few minutes); if code appears hung or the lockfiles are from a few days ago, then something is wrong. The lockfiles are links to the file they are locking, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">sdss5</span> <span class="n">sdss5</span>    <span class="mi">542</span> <span class="n">Mar</span>  <span class="mi">9</span> <span class="mi">01</span><span class="p">:</span><span class="mi">17</span> <span class="n">sdHdrFix</span><span class="o">-</span><span class="mf">57090.</span><span class="n">par</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">sdss5</span> <span class="n">sdss5</span>     <span class="mi">18</span> <span class="n">Mar</span>  <span class="mi">9</span> <span class="mi">18</span><span class="p">:</span><span class="mi">17</span> <span class="n">sdHdrFix</span><span class="o">-</span><span class="mf">57090.</span><span class="n">par</span><span class="o">.</span><span class="n">lock</span> <span class="o">-&gt;</span> <span class="n">sdHdrFix</span><span class="o">-</span><span class="mf">57090.</span><span class="n">par</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you need to remove a lock, it is very important to remove the lock and not the file to which it is pointing. In the example above, remove the file with extension .par.lock, not .par file. i.e. issue <code class="code docutils literal notranslate"><span class="pre">rm</span> <span class="pre">$SDSSCORE_DIR/$OBSERVATORY/sdHdrfix/sdHdrFix-57090.par.lock</span></code>. DON’T issue <code class="code docutils literal notranslate"><span class="pre">rm</span> <span class="pre">$SDSSCORE_DIR/$OBSERVATORY/sdHdrfix/sdHdrFix-57090.par</span></code>.</p>
</div>
</section>
</section>
<section id="re-reducing-data-with-sos">
<h2>Re-Reducing Data with SOS<a class="headerlink" href="#re-reducing-data-with-sos" title="Permalink to this heading">#</a></h2>
<p>In cases where data nees to be re-reduced, this can be done manually (using the sdss5 user on sdss5-bhm) after loading the idlspec2d module. To reduce the blue and red channels independently</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SOS</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">m</span> <span class="n">MJDXX</span> <span class="o">-</span><span class="n">e</span> <span class="n">EXPIDXX</span>
<span class="n">SOS</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">m</span> <span class="n">MJDXX</span> <span class="o">-</span><span class="n">e</span> <span class="n">EXPIDXX</span>
</pre></div>
</div>
<p>or jointly using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SOS</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">m</span> <span class="n">MJDXX</span> <span class="o">-</span><span class="n">e</span> <span class="n">EXPIDXX</span>
</pre></div>
</div>
<p>the MJD can be negelected if the data is for the current MJD and the EXPID can be a single exposure ID or a range of exposure IDs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the S/N in one of the BOSS cameras does not appear in Kronos, you can run this command to re-reduce an exposure using this command. You can check the log files at /home/sdss5/boss/sos/logs/sos_log-b1-error or (sos_log-r1-error). tail -n 150 sos_log-b1-error will show the last 150 lines of the error long and should show enough of the log to determine if the current exposure crashed due to  “Failed to acquire license.”</p>
</div>
</section>
<section id="frequently-used-commands">
<h2>Frequently Used Commands<a class="headerlink" href="#frequently-used-commands" title="Permalink to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All commands are executed from sdss5 on sdss5-bhm. All commands assume that idlspec2d is set up  <code class="code docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">idlspec2d</span></code>.</p>
</div>
<section id="start-sos-processes-after-observing-has-started-for-the-night">
<h3>Start SOS Processes After Observing Has Started For the Night:<a class="headerlink" href="#start-sos-processes-after-observing-has-started-for-the-night" title="Permalink to this heading">#</a></h3>
<p>Use this command if the SOS process was not started until after observing has started for the night or an issue is identified later in the night. This procedure will process all images already present for the current MJD (or when utilizing the –mjd flag for the specified MJD). This can be combined with a –exp to reprocess a single exposure or range of exposures. Unlike the older version of sos, this command is designed to be run in parallel to the systemd processes allowing for reprocessing of the earlier data while new data is still being taken and processed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">idlspec2d</span>
<span class="n">SOS</span> <span class="o">-</span><span class="n">b</span> <span class="o">-</span><span class="n">c</span>
<span class="n">SOS</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">c</span>
</pre></div>
</div>
<p>these logs have _catchup added to the file names</p>
<section id="other-flag">
<h4>Other flag<a class="headerlink" href="#other-flag" title="Permalink to this heading">#</a></h4>
<p>In addition to the catchup mode,  SOS has other options that can either be added to the -c option or run in place of the -c option</p>
<dl class="option-list">
<dt><kbd><span class="option">-e <var>XXXXXXX</var></span></kbd></dt>
<dd><p>(–exp)     rerun a single or range of exposures (eg 100-110) exposure (works with -c, -m, or -t)</p>
</dd>
<dt><kbd><span class="option">-m <var>XXXXX</var></span></kbd></dt>
<dd><p>(–mjd)     rerun for an MJD (these logs have _{mjd} added to the filename) (can be combined with -c to reprocess a night in the sos folder or -t in the sosredo folder)</p>
</dd>
<dt><kbd><span class="option">-t</span></kbd></dt>
<dd><p>(–redoMode)    rerun and save in (these logs have _redo added to the filename) (in place of -c) -This mode is primarily for testing and not designed for use by the observers.</p>
</dd>
<dt><kbd><span class="option">-j</span></kbd></dt>
<dd><p>(–joint)   will run both red and blue in parallel (overrides -r or -b, and can be run with any of the other options)</p>
</dd>
<dt><kbd><span class="option">--no_reject</span></kbd></dt>
<dd><p>will override the calibration rejection codes (to force a faint calibration through) - This is a last resort if the lamp dies during the night and replacement is not an option, since it will likely cause difficulties in the main pipeline that require trial &amp; error and hand holding to reduce. SOS will still provide the same warnings but will produce output for calibration (note the override in the night logs). This should NOT be forced if flat 80% &lt; 200 (as reported by SOS) or 2 lamps are out. If the outage of a single lamp happens at the start or early in the night (or multiple lamps burn out), then immediate replacement (either then or at the end of that field) is highly preferred.</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="sos-outputs">
<h2>SOS Outputs<a class="headerlink" href="#sos-outputs" title="Permalink to this heading">#</a></h2>
<section id="tabulated-values">
<h3>Tabulated Values<a class="headerlink" href="#tabulated-values" title="Permalink to this heading">#</a></h3>
<p>Son-of-Spectro reduces four flavors of observations: bias/dark, flat, arc, &amp; science. Select information is tabulated for each of these types of observations. These values are tabulated in yellow if they are going out of spec, and in red if they are very much out of spec. The values reported are:</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">BIAS/DARK</span> <span class="pre">PERCENTILE98</span></code>:     The value in electrons of the 98-th percentile on the (overscan-corrected) image. For example, if this is 8, then 98% of the pixels are below 8 electrons. Bad regions on the CCD and saturated pixels are excluded from this evaluation. The CCDs can also accumulate charge during the day that may need several bias exposures to completely flush. If this does not work, then the CCD is probably warm.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">FLAT</span> <span class="pre">NGOODFIBER</span></code>: The number of illuminated fibers. This should be 320 if all the fibers are plugged and unbroken. Note that fibers that fall on particularly bad parts of the CCD can also be excluded from the good fiber list (the red CCDs have some of these cases). If this number is less than about 315, then you should be suspicious that some fibers have dropped out.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">FLAT</span> <span class="pre">XMIN</span> <span class="pre">(XMAX)</span></code>: The minimum (maximum) X position of the spectra on the CCD. If this is less than 0 (greater than 2047), then some of the spectra fall off the left (right) side of the CCD. This probably means that no one ran the Spectro Monthly Checkout. If it is off by more than 5 pix or so, you should probably run the Monthly Checkout (if it has been run contact Sean Morrison to reduce and update the specflat product)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">FLAT</span> <span class="pre">XSIGMA</span></code>: The profiles in the spatial (X) dimension have a gaussian fit with a width of this sigma. The median of this width is taken independently in each of 4 quadrants on a CCD, and the maximum of those 4 values reported. If the spectrographs are in focus, then this value should be about 1.0 pix. If it is larger, then the spectrographs may be out-of-focus, or the slit-heads may not be properly latched.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ARC</span> <span class="pre">WAVEMIN</span> <span class="pre">(WAVEMAX)</span></code>: The minimum (maximum) wavelength (in Angstroms) of any spectra on this CCD. Because of the optical distortions, this is always for the central fiber. The edge fibers have less wavelength coverage. This probably means that no one ran the Spectro Monthly Checkout. If it is off by more than 5 pix or so, you should probably run the Monthly Checkout. (if it has been run contact Sean Morrison to reduce and update the specflat product)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ARC</span> <span class="pre">BESTCORR</span></code>: The linear correlation coefficient between the arc spectra and a template arc spectrum. If they agree perfectly, then this is 1. The value of this correlation is typically 0.80. If it drops too much lower, then the arc spectra do not look as they should. This could happen if the arcs did not turn on, the flat field screens did not close, or some of the arc lines are missing – if, for example, the Hg lamps all failed. If the correlation is less than 0.5 or so, then it’s even possible that the code has found the incorrect wavelength solution.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ARC</span> <span class="pre">NLAMPS</span></code>: The number of arc lines used to generate the wavelength solution. There are many more on the red CCD’s because neon has many more lines there. If this drops to too few lines, then some of the lamps have not turned on properly, have not warmed up, or have warmed up too much.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">ARC</span> <span class="pre">WSIGMA</span></code>: The arc-line profiles in the wavelength (Y) dimension have a gaussian fit with a width of this sigma. The median of this width is taken independently in each of 4 quadrants on a CCD, and the maximum of those 4 values reported. If the spectrographs are in focus, then this value should be about 1.0 pix. If it is larger, then the spectrographs may be out-of-focus, or the slit-heads may not be properly latched. (One would expect that both XSIGMA and WSIGMA would go out-of-focus at the same time.)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">SCIENCE</span> <span class="pre">SKY/SEC</span></code>: The median sky counts in electrons per pixel. If this is too large, then there must be a light source near the telescope, or the night sky (the moon) is bright, or the CCD’s are warming up and generating dark current.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">SCIENCE</span> <span class="pre">(S/N)2</span></code>: The signal-to-noise squared for objects at the fiducial magnitude limit. We choose (S/N)2 because it is an additive quantity with additional integration time. Exactly how this quantity is measured is described below.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">SCIENCE</span> <span class="pre">(S/N)2_v2</span></code>: The signal-to-noise squared for objects at a fiducial magnitude limit. We choose (S/N)2 because it is an additive quantity with additional integration time. Exactly how this quantity is measured is described below.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">SCIENCE</span> <span class="pre">Mag15</span> <span class="pre">(S/N)2</span></code>: The signal-to-noise squared for objects at a fiducial magnitude of 15 limit. We choose (S/N)2 because it is an additive quantity with additional integration time. Exactly how this quantity is measured is described below.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">EXPTIME</span></code>: The exposure time (EXPTIME) header keyword from the first camera of this exposure to be reduced. The assumption is that all 2 cameras have the same EXPTIME.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">AIRTEMP</span></code>: The air temperature (AIRTEMP) header keyword from the first camera of this exposure to be reduced. The assumption is that all 2 cameras have the same AIRTEMP.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">UT</span></code>: The UT time computed from TAI in the header from the first camera of this exposure to be reduced.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">QUALITY</span></code>: This is the observer-input quality for this exposure. It can be set independently for each of the 2 cameras, but only one camera value (the first reduced frame) is reported in this table. The default value is “excellent” for everything except for dithered flats or spectro focus frames which are “test”. The observers have the option of declaring exposures “excellent”, “test”, or “bad” using the sdr_hdrfix.py command.</p>
<p>The exact values of these yellow/red limits and further explanation can be found in the “idlspec2d” product in the file “examples/opLimits.par”.</p>
</section>
<section id="warning-and-abort-messages">
<h3>WARNING and ABORT messages<a class="headerlink" href="#warning-and-abort-messages" title="Permalink to this heading">#</a></h3>
<p>There are a number of WARNING and ABORT messages that can appear if the pipeline runs into trouble when processing a frame. These messages appear at the bottom of each table. Each one-line message begins with the relevant file name, WARNING or ABORT, then a brief plain-text message.</p>
<p>Note that a single problem may cascade into a large number of warning messages. For example, an out-of-focus spectrograph will first produce the “Median spatial widths” message, probably followed by warnings about bad sky-residuals.</p>
<section id="general-frame-messages-valid-for-flats-arcs-science">
<h4>General Frame Messages (valid for flats/arcs/Science)<a class="headerlink" href="#general-frame-messages-valid-for-flats-arcs-science" title="Permalink to this heading">#</a></h4>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">bias</span> <span class="pre">exploding</span> <span class="pre">in</span> <span class="pre">b2</span> <span class="pre">crazy</span> <span class="pre">quadrant</span></code>: This indicates a hardware electronics problem with the b2 bias levels. Keep observing, but note this prominently in the night log. The SOS b2 (S/N)2 values might be crazy – if they look unusual, use the other channels to determine plate doneness, and note this in the log.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Amp</span> <span class="pre">#...</span> <span class="pre">expected</span> <span class="pre">read</span> <span class="pre">noise</span> <span class="pre">=</span> <span class="pre">...,</span> <span class="pre">measured</span> <span class="pre">=</span> <span class="pre">...</span> <span class="pre">DN</span></code>: The number reported is the standard deviation in the bias region for either amplifier #2 (left side) or amplifier #3 (right side). This calculation is done clipping the half-percent of lowest and highest values. We trigger this warning if the value is ever 1.0 DN above the expected value. This can happen if there are a huge number of cosmic rays (if you’ve been integrating for hours), or if there is an electronics problem.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Amp</span> <span class="pre">#...</span> <span class="pre">bias</span> <span class="pre">region</span> <span class="pre">difference</span> <span class="pre">at</span> <span class="pre">xxx-th-percentile</span> <span class="pre">=...</span> <span class="pre">DN:</span></code> This measures another statistic of the bias region for either amplifier #2 (left side) or amplifier #3 (right side). This measures the difference between the 16th-percentile and 84th-percentile, which should be equal to twice the read noise (e.g., 1-sigma). This test is done at the 68.2-percentile (1 sigma), 95.4-percentile (2 sigma), and 99.7-percentile (3 sigma). A warning is reported if this difference is either significantly too small or too large, as compared to what gaussian statistics dictate. This should catch the same sorts of electronics problems as listed for the above warning message.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Amp</span> <span class="pre">#...</span> <span class="pre">way</span> <span class="pre">too</span> <span class="pre">many</span> <span class="pre">pixels</span> <span class="pre">(xxx%)</span> <span class="pre">below</span> <span class="pre">bias-5*sigma=...</span> <span class="pre">DN</span></code>: This test looks for anomalously low pixel values in the data region of the CCD. There should essentially never be any pixel values below 5-sigma less than the bias level, unless there is something wrong with the electronics.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Fixing</span> <span class="pre">shifted</span> <span class="pre">rows</span> <span class="pre">(from</span> <span class="pre">electronics)</span></code>: This is very, very bad. The raw images have rows shifted to the right, sometimes by many pixels. Call José immediately.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Fixing</span> <span class="pre">dropped-pixel</span> <span class="pre">rows</span> <span class="pre">(from</span> <span class="pre">electronics)</span></code>: This is very bad.  The raw images actually have some rows shifted by 1 or 2 pixels, usually more so near the bottom of the CCD (the first rows to be read). Call José immediately.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Electronics</span> <span class="pre">shifted</span> <span class="pre">xxx</span> <span class="pre">rows</span> <span class="pre">by</span> <span class="pre">2</span> <span class="pre">pix</span></code>: This is indicative of an electronics problem with the BOSS electronics that shifts all or some of the rows in the raw images in all 4 amplifiers</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">More</span> <span class="pre">than</span> <span class="pre">10%</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">image</span> <span class="pre">is</span> <span class="pre">rejected</span></code>: This is very bad. This can probably only happen if most of the CCD has saturated pixels, which probably means you’re observing during twilight, the CCDs are warm, or the dome lights are on.</p>
</section>
<section id="science-frame-messages">
<h4>Science Frame Messages<a class="headerlink" href="#science-frame-messages" title="Permalink to this heading">#</a></h4>
<ul>
<li><p>Unable to reduce science exposure:</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">reduce</span> <span class="pre">this</span> <span class="pre">science</span> <span class="pre">exposure</span> <span class="pre">(need</span> <span class="pre">flat)</span></code>: A valid reduced flat field frame is required for processing</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">reduce</span> <span class="pre">this</span> <span class="pre">science</span> <span class="pre">exposure</span> <span class="pre">(need</span> <span class="pre">arc)</span></code>: A valid reduced arc lamp frame is required for processing</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">science</span> <span class="pre">...</span></code>: A science exposure can be rejected if the header keywords indicate that the flat-field petals are closed, any flat-field or arc lamps are turned on, too many pixels are bad or saturated, or if the 25-th percentile of the image too large.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">science:</span> <span class="pre">Flat-field</span> <span class="pre">screens</span> <span class="pre">are</span> <span class="pre">closed!</span></code></p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">science:</span> <span class="pre">Flat-field</span> <span class="pre">lamps</span> <span class="pre">turned</span> <span class="pre">on!</span></code></p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">science</span> <span class="pre">as</span> <span class="pre">too</span> <span class="pre">bright:</span> <span class="pre">25-th-percentile</span> <span class="pre">=</span> <span class="pre">....</span></code></p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Scattered</span> <span class="pre">light</span></code>: There was a high baseline count rate on the CCD, and appears even between fibers. This can most obviously occur if there are light sources in the CCD (such as the LED’s we had for some time), or if the CCD’s are warming up and generating dark current. There can also be a scattered light contribution just from a very bright sky, or if there are super-bright objects on some fibers that are scattering or bleeding light across the CCD. It’s best to carefully inspect the raw images for problems.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Large</span> <span class="pre">flexure</span> <span class="pre">flat&lt;-&gt;science</span></code>: There is a large shift (more than 1.00 pix) between the flat-field and the science exposure, presumably from flexure in the spectrographs. When this happens, another set of flat-fields (post-calibs) is recommended. (However, don’t bother to take a set of calibrations on a different night. The Spectro-2D reductions never use calibrations from one night for science exposures on another.)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Whopping</span> <span class="pre">fiber</span> <span class="pre">....</span></code>: The fibers listed have very bright objects that affect their neighbors on the CCD. If the objects are bright enough (12th mag?), then this can trigger other warnings such as “scattered light”. I think it’s safe to say that whopping fibers only show up when there has been a mistake made in the plate designs – this is already recorded in PR 2471. You should check that this object does not saturate (&gt; 30,000 ADU) the raw sdR image. Should it be saturating, reduce the exposure time to prevent saturation or move on to the next plate.</p>
</li>
<li><p>The following warning messages are all based upon the quality of the sky-subtraction. Typically, we are able to model the sky spectrum (from the 16 sky fibers on each spectrograph) with a relative chi2 of around unity. At very bright sky lines, like 5577 Ang, the relative chi2 may be as large at 25. If the relative chi2 is large at other wavelengths, this means that there is excess light down the fibers that vary across the plate. This could be due to a light source near the telescope, or possibly a bright, non-uniform sky. Strong auroral activity is something that can do this, since the O I lines at 6300 and 6366 Ang are resolved on the sky.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Too</span> <span class="pre">few</span> <span class="pre">sky</span> <span class="pre">fibers</span> <span class="pre">to</span> <span class="pre">model</span> <span class="pre">sky-sub</span> <span class="pre">variance</span></code>: There are not enough good sky fibers on the CCD. This will only happen if for some reason there were far fewer than the mandated 16 sky fibers on a CCD, or most of those fibers just happened to be dead fibers. You should never see this message. If you do, the data is un-reducable. You could try one more exposure, but something is probably horribly wrong with this plate.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Median</span> <span class="pre">sky-residual</span> <span class="pre">chi2</span> <span class="pre">=</span> <span class="pre">...</span> <span class="pre">at</span> <span class="pre">...</span> <span class="pre">Ang</span></code>: The median reduced chi2 for sky-subtraction is always around unity. If it is greater than 2, this message is triggered. If this message appears and you are not observing during twilight or with warm CCDs, then there must be a serious problem. Seriously out-of-focus spectrographs might trigger this, or lights on near the telescope.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Max</span> <span class="pre">sky-residual</span> <span class="pre">chi2</span> <span class="pre">=</span> <span class="pre">...</span> <span class="pre">at</span> <span class="pre">...</span> <span class="pre">Ang</span> <span class="pre">(ignoring</span> <span class="pre">5577)</span></code>: This is an informational message triggered if the reduced chi2 is greater than 100 anywhere other than at the 5577 Ang sky line. If there is auroral activity, then this could be triggered at a few specific lines like O I at 6300 and 6366 Ang. These O I lines has reduced chi2 values of about 100 on MJD 51999 during a solar storm (i.e. plate 336/51999). The Spectro-2D pipeline will automatically mask these wavelengths for any downstream analyses.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Bad</span> <span class="pre">sky</span> <span class="pre">residuals</span> <span class="pre">at</span> <span class="pre">....</span></code>: This warning is triggered if there is a range of at least 25 Angstroms with a reduced chi in the sky-subtraction worse than 2. This could be due to a light source near the telescope, a bright, non-uniform sky, a warm CCD, scattered light, or out-of-focus spectrographs. For most of those cases, there should be other relevant warning messages preceding this one (like a warm CCD message). This message should be ignored at the edges of the CCDs wavelength coverage – near 3800 or 6200 Ang for b1,b2 or near 5800 or 9200 Ang for r1,r2. If none of the above explanations apply, then there is some real problem.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Red</span> <span class="pre">Monster</span> <span class="pre">at</span> <span class="pre">....</span></code>: This warning is triggered if we see bad sky residuals (above) that is specifically in the wavelength range of about 6400-6600 Ang. We think this happens when the handpaddle is still plugged in, in which case the observers should unplug it immediately. The threshold is set at reduced chi=2, and the worst that we have ever seen is at about the level chi=6. ii You should be able to see a bump in the extracted spectra, especially for the sky fibers.</p>
</li>
</ul>
</section>
<section id="flat-frame-messages">
<h4>Flat Frame Messages<a class="headerlink" href="#flat-frame-messages" title="Permalink to this heading">#</a></h4>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Flat-field</span> <span class="pre">screens</span> <span class="pre">not</span> <span class="pre">closed</span></code>: The “FFS” keyword in the header indicates that at least one of the flat-field petals was not closed. When this happens, the flat or arc is not reduced.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Flat-field</span> <span class="pre">lamps</span> <span class="pre">not</span> <span class="pre">turned</span> <span class="pre">on</span></code>: The “FF” keyword in the header indicates that at least one of the four flat-field lamps was not turned on. When this happens, the flat is not reduced.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">flat</span> <span class="pre">(or</span> <span class="pre">arc)</span> <span class="pre">...</span> <span class="pre">%</span> <span class="pre">bad</span> <span class="pre">pixels</span></code>: This condition is triggered when more than 2% of the non-masked pixels on the image are bad (saturated). When this happens, the flat (or arc) is not reduced. This probably happens if the CCDs are warm, the dome lights are on, or if for some reason the shutters were open too long.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">flat</span> <span class="pre">(or</span> <span class="pre">arc)</span> <span class="pre">...</span> <span class="pre">saturated</span> <span class="pre">rows</span></code>: This condition is triggered when there are more than 100 saturated rows on the image. When this happens, the flat (or arc) is not reduced. This probably happens if the CCDs are warm, the dome lights are on, or if for some reason the shutters were open too long.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">flat</span> <span class="pre">as</span> <span class="pre">too</span> <span class="pre">faint</span></code>: This condition is triggered when the 80-th percentile of the image is less than 1000 electrons. When this happens, the flat is not reduced. Either the flat field screens were not closed, the lamps were not turned on, or the shutter didn’t open.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Possible</span> <span class="pre">Argon</span> <span class="pre">lines</span> <span class="pre">in</span> <span class="pre">superflat</span></code>: Emission lines are present in the quartz-halogen flat-field images, which are supposed to be featureless. When a number follows this message, that is a measure of the line strength – the trigger is set to 0.01, but we usually see it as 0.1 to 0.5 when present. We have identified these rogue lines as argon. best guess is that these contaminating lines come from trace amounts of argon in the HgCd lamps, which must still have current running through them when they are supposed to be off.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Median</span> <span class="pre">spatial</span> <span class="pre">widths</span> <span class="pre">=</span> <span class="pre">...</span></code>: The spatial (X) widths of the fibers typically are gaussians with a sigma of 0.85 to 1.05 pixels. If the sigma is larger than 1.10 pixels in any of the 4 quadrants of a CCD (lower-left, lower-right, upper-left, upper-right), then this warning is triggered. It means that either the spectrographs are out of focus, or the slit-heads are not properly latched. Note that these widths are computed for both the flat and science exposures (but not for arcs – we compute the widths in the dispersion dimension for arcs).</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Unable</span> <span class="pre">to</span> <span class="pre">reduce</span> <span class="pre">this</span> <span class="pre">flat</span> <span class="pre">exposure</span> <span class="pre">(need</span> <span class="pre">plug-map)</span></code>: There is something wrong with the plug-map  or confSummary file (You should not see this in the FPS era, but if you do contact José)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">All</span> <span class="pre">centroids</span> <span class="pre">rejecte`d</span></code>: Something went significantly wrong with the tracing. Try taking another flat and if this error appears again contact the Sean Morrison Immediately</p>
</section>
<section id="arc-frame-messages">
<h4>Arc Frame Messages<a class="headerlink" href="#arc-frame-messages" title="Permalink to this heading">#</a></h4>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Flat-field</span> <span class="pre">screens</span> <span class="pre">not</span> <span class="pre">closed</span></code>: The “FFS” keyword in the header indicates that at least one of the flat-field petals was not closed. When this happens, the flat or arc is not reduced.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">flat</span> <span class="pre">(or</span> <span class="pre">arc)</span> <span class="pre">...</span> <span class="pre">%</span> <span class="pre">bad</span> <span class="pre">pixels</span></code>: This condition is triggered when more than 2% of the non-masked pixels on the image are bad (saturated). When this happens, the flat (or arc) is not reduced. This probably happens if the CCDs are warm, the dome lights are on, or if for some reason the shutters were open too long.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">flat</span> <span class="pre">(or</span> <span class="pre">arc)</span> <span class="pre">...</span> <span class="pre">saturated</span> <span class="pre">rows</span></code>: This condition is triggered when there are more than 100 saturated rows on the image. When this happens, the flat (or arc) is not reduced. This probably happens if the CCDs are warm, the dome lights are on, or if for some reason the shutters were open too long.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">X/4</span> <span class="pre">....</span> <span class="pre">Arc</span> <span class="pre">lamps</span> <span class="pre">are</span> <span class="pre">off</span></code>: The “NE”, “HGCD”, “HEAR” keywords in the header indicates that either the NE, HeAr, or HgCd lamps are not fully turned on. When this happens, the arc is not reduced.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Arc</span> <span class="pre">lamps</span> <span class="pre">not</span> <span class="pre">turned</span> <span class="pre">on</span></code>: The “NE”, “HGCD”, “HEAR” keywords in the header indicates that either the NE, HeAr, or HgCd lamps are not fully turned on. When this happens, the arc is not reduced. (replaced by the message above)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Neither</span> <span class="pre">Ne</span> <span class="pre">nor</span> <span class="pre">HeAR</span> <span class="pre">(HgCd)</span> <span class="pre">lamps</span> <span class="pre">turned</span> <span class="pre">on!</span></code>: The “NE”, “HGCD”, “HEAR” keywords in the header indicates that either the NE, HeAr, or HgCd lamps are not fully turned on. When this happens, the arc is not reduced.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Best</span> <span class="pre">arc</span> <span class="pre">correlation</span> <span class="pre">=</span> <span class="pre">...</span></code>: The cross-correlation of the arc spectrum with the template arc spectrum was bad. This problem also triggers BESTCORR as bad in the table (see above). This may be due to too little signal in the lamps, e.g. if the flat field petals did not close or the lamps did not turn on. If those are not the problems, then look at the raw image.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Big</span> <span class="pre">wavelength</span> <span class="pre">gap</span></code>: Some arc lines were not found in the arc spectra, and there is a large gap in wavelength space without any lines. This will produce a poor wavelength solution. More arcs should be taken until this message does not appear.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Median</span> <span class="pre">wavelength</span> <span class="pre">widths</span> <span class="pre">=</span> <span class="pre">...</span></code>: The widths of the arc lines in the dispersion (Y) dimension typically are gaussians with a sigma of 0.90 to 1.10 pixels. If the sigma is larger than 1.10 pixels in any of the 4 quadrants of a CCD (lower-left, lower-right, upper-left, upper-right), then this warning is triggered. It means that either the spectrographs are out of focus, or the slit-heads are not properly latched.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Arc</span> <span class="pre">exposure,</span> <span class="pre">waiting</span> <span class="pre">for</span> <span class="pre">flat</span> <span class="pre">before</span> <span class="pre">reducing</span></code>: Take a flat, and if that flat is valid then arc should be reduced, if not, then take another arc (or use SOS -j -c -e XXXX where XXXX is the exposure number to re-reduce the arc after getting the flat)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Reject</span> <span class="pre">arc</span> <span class="pre">image</span> <span class="pre">too</span> <span class="pre">few</span> <span class="pre">lines</span></code>: The lamps were not properly on or warmed up. Take an additional Arc</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cd</span> <span class="pre">I</span> <span class="pre">3610</span> <span class="pre">line</span> <span class="pre">missing</span> <span class="pre">(lamps</span> <span class="pre">not</span> <span class="pre">warm?)</span></code>: This particular arc line is the tie-down of the UV wavelength calibration and is either missing or has a poor fit. This is likely due to the HgCd lamps not being sufficiently warm before the exposure start. (depreciated)</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Wavelength</span> <span class="pre">mapping</span> <span class="pre">makes</span> <span class="pre">no</span> <span class="pre">sense!</span></code>: Something has going significantly wrong. Try taking another arc, if you get this again, visually check the arc to look for artifacts and the lamp status, and then check the focus. If all seems in order contact Sean Morrison for further investigation.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Spline</span> <span class="pre">fit</span> <span class="pre">failed</span></code>: Something has gone wrong with the flat-arc pair. Try taking another pair of flat and arc.</p>
</section>
<section id="misc-messages">
<h4>Misc messages<a class="headerlink" href="#misc-messages" title="Permalink to this heading">#</a></h4>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Airmass</span> <span class="pre">range</span> <span class="pre">=</span> <span class="pre">...</span></code>: This warning is triggered if the airmass exceeds 2.5. At such large airmasses, the atmospheric refraction terms are getting large and the sky background is bright. The data is still perfectly usable, it’s just not as good as taking data at lower airmass. Keep observing if you must, but the airmass will rapidly approach infinity!</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">SOS</span> <span class="pre">disk</span> <span class="pre">is</span> <span class="pre">...%</span> <span class="pre">full</span></code>: The specified disk is more than 95% full. Contact operations list to have Pipeline/Data teams clean out old data</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Sun</span> <span class="pre">above</span> <span class="pre">the</span> <span class="pre">horizon</span> <span class="pre">by</span> <span class="pre">...</span> <span class="pre">deg</span> <span class="pre">for</span> <span class="pre">non-test</span> <span class="pre">exposure</span></code>: This warning message is to trap flat, arc, or science exposures taken during the day that have not been marked as either “test” or “bad” data. If these are test data, be sure to mark them as such. This is to prevent such data from being used later in the full reductions.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Exposure</span> <span class="pre">number</span> <span class="pre">in</span> <span class="pre">header</span> <span class="pre">disagrees</span> <span class="pre">w/</span> <span class="pre">filename</span></code>: This means that something is in a very confused state, and it is putting a different exposure number in the header (EXPOSURE keyword) from what is being used to generate file names. You should probably contact restart the BOSS(APO) or YAO(LCO) actors and contact José</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Error</span> <span class="pre">reading</span> <span class="pre">sdHdrFix</span> <span class="pre">file</span></code>: The sdHdrFix file (sdHdrFix-$MJD.par) in /home/sdss5/software/sdsscore/main/*/sdHdrfix/ exists but is not a valid Yanny parameter file. This file is written by the procedure sdr_hdrfix.py if the observers have run that proc on any of the sdss5 machines, but can also be edited by hand. If the file is invalid, you should edit it to be valid, or delete it.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">Wrong</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">elements</span> <span class="pre">for</span> <span class="pre">REDDEN_MED</span></code>: This is a warning that the reddening vector for this plate (reddeningMed in the plPlugMapM file) is not a 5-element vector, as expected). In this case, reddening values of zero are assumed. This means that the plate will not be observed as deep as it would have if non-zero reddening values were provided. (depreciated)</p>
</section>
</section>
<section id="s-n-figures">
<h3>S/N Figures<a class="headerlink" href="#s-n-figures" title="Permalink to this heading">#</a></h3>
<p>A median signal-to-noise is computed for each object in the wavelength ranges [4000,5500] Angstroms (synthetic g-band) and [6910,8500] Angstroms (synthetic i-band). We plot these S/N values versus the PHOTO fiber magnitudes, which were measured in approximately a 3-arcsec diameter aperature (the same size as our fibers). If everything is working perfectly, then our S/N values should correlate very well with these PHOTO magnitudes.</p>
<p>We determine whether a plate is “done” based upon the signal-to-noise of the fainter objects on the plate. We do this by fitting a line to the (S/N)-vs.-magnitude plot in a specified wavelength range, then evaluating this fit at g=22.0 mag (blue CCDs), and i=21.0 mag (red CCDs). For the v2 S/N estimates the fits are evaluated at g=19 and r=19, and for the mag 15 S/N estimates the fits are evaluated at g=15 and r=15.</p>
<p>When the sky level is higher, we gain S/N more slowly at the fainter magnitudes where we are sky-limited rather than photon-limited.</p>
<p>Without moon, we have historically found</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">N_g</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">zeropoint</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.31</span> <span class="o">*</span> <span class="n">g</span>
<span class="n">log</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">N_i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">zeropoint</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.31</span> <span class="o">*</span> <span class="n">i</span>
</pre></div>
</div>
<p>With partial moon, the slope steepens to -0.34 or worse.</p>
<p>However, in practice in SDSS-V we utilize</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">N_g</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">zeropoint</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.32</span> <span class="o">*</span> <span class="n">g</span>
<span class="n">log</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">N_i</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">zeropoint</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.36</span> <span class="o">*</span> <span class="n">i</span>
</pre></div>
</div>
<p>The fitting regions are denoted on the plot with vertical dotted lines. Arrows point to the evaluation of the fit on each of the 4 cameras, with the top panels corresponding to the blue CCD’s (synthetic g-band) and the bottom panels corresponding to the red (synthetic r-band). In SDSS-V FPS, if less then 10 targets have magnitudes within the fit range, the fit range bright limit is extened to include all target.</p>
<p>The right-hand figures plot the residuals of each object from the fit. Symbol sizes on those right-hand plots indicate the magnitude of the deviation from the fit line. Symbol color is the same on the left as on the right, so green objects have more flux and red ones less. If the scale of the telescope is wrong, then you will see a radial drop-off in flux (red points on the edge of the plate). If you are observing too far over in air mass, then typically you correct to first order with a scale change, but a quadropole is left in these residuals. If one spectrograph has problems, then this will show up as red points in half of one of these figures.</p>
<p>Note that the (S/N)2 totals listed in the table and the figure might not exactly agree. This is because the fitting to (S/N)-vs.-magnitude is done on individual frames for the table, but on the summed S/N over all frames for the figure. The tabulated values are the ones we use to declare a plate done.</p>
</section>
<section id="throughput-summary-analysis-figures">
<h3>Throughput Summary Analysis Figures<a class="headerlink" href="#throughput-summary-analysis-figures" title="Permalink to this heading">#</a></h3>
<p>In the FPS era we added additional throughput analysis figures (linked via the SOS Summary Plots link at the top of the page). These figures show flux and S/N^2 as a functions of fiberid and magnitude. The Mag to Flux and Mag to S/N^2 figures include reference lines measured from a typically SDSS-IV/V plate to help understand throughput loss due to FPS fiber placements. This is also expressed in the x-focal vs y-focal vs log(ref_plate_flux/flux), which can be useful as a quick check of the overall fiber placement scale factors. The final panel is the extracted 1d spectra (though typically the scaling makes this figure hard to read).</p>
</section>
<section id="arc-to-trace-qa-figures">
<h3>Arc To Trace QA Figures<a class="headerlink" href="#arc-to-trace-qa-figures" title="Permalink to this heading">#</a></h3>
<p>In the FPS era we have added the ability to use arc frames to tweak the traces as measured at the start of night operations. If this option is active, QA figures are produced of the trace shifts and linked via the Arc Shift Plots link at the top of the page. In the figures with 4 panels shows the original meaured shifts. The additional 3 panels shows the various transformations. Red vectors in the plots show discard points in the transformations. In the figure with 2 panels the top shows the net shift per fiber along the traces. And the bottom panel shows (if a trace flat is also taken for the field of the arc) the difference between the arc tweaked traces and the traces as measured by the flat for that field. In the lower panel, the dashed tails are portions of traces that are not used for the science frames.</p>
</section>
<section id="log-files">
<h3>Log Files<a class="headerlink" href="#log-files" title="Permalink to this heading">#</a></h3>
<p>If the reduction of an exposure is catastrophically bad, it may not appear at all in the Son-of-Spectro table. However, there should still be a log file for this exposure on the data drive: /data/boss/sos/$MJD/splog-$CAMERA-$EXPOSURE.log</p>
<p>Reading this file should tell you what failed. The first and last lines of these files should contain “Started at” and “Finished at” followed by timestamps. If this does not provide you with any information you can check the latest process logs for the camera in /home/sdss5/boss/sos/logs.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Dependencies.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Pipeline Dependencies</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="daily.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Running a BOSS DRP Daily Run</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, SDSS Collaboration
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Son-of-spectro (SOS): The BOSS on Mountain Pipeline</a><ul>
<li><a class="reference internal" href="#sos-as-a-systemctl-process">SOS as a systemctl process</a><ul>
<li><a class="reference internal" href="#backing-out-to-an-older-version">Backing out to an Older Version</a></li>
<li><a class="reference internal" href="#troubleshooting-sos">Troubleshooting SOS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#re-reducing-data-with-sos">Re-Reducing Data with SOS</a></li>
<li><a class="reference internal" href="#frequently-used-commands">Frequently Used Commands</a><ul>
<li><a class="reference internal" href="#start-sos-processes-after-observing-has-started-for-the-night">Start SOS Processes After Observing Has Started For the Night:</a><ul>
<li><a class="reference internal" href="#other-flag">Other flag</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#sos-outputs">SOS Outputs</a><ul>
<li><a class="reference internal" href="#tabulated-values">Tabulated Values</a></li>
<li><a class="reference internal" href="#warning-and-abort-messages">WARNING and ABORT messages</a><ul>
<li><a class="reference internal" href="#general-frame-messages-valid-for-flats-arcs-science">General Frame Messages (valid for flats/arcs/Science)</a></li>
<li><a class="reference internal" href="#science-frame-messages">Science Frame Messages</a></li>
<li><a class="reference internal" href="#flat-frame-messages">Flat Frame Messages</a></li>
<li><a class="reference internal" href="#arc-frame-messages">Arc Frame Messages</a></li>
<li><a class="reference internal" href="#misc-messages">Misc messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#s-n-figures">S/N Figures</a></li>
<li><a class="reference internal" href="#throughput-summary-analysis-figures">Throughput Summary Analysis Figures</a></li>
<li><a class="reference internal" href="#arc-to-trace-qa-figures">Arc To Trace QA Figures</a></li>
<li><a class="reference internal" href="#log-files">Log Files</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=aaf0a054"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=df1a032d"></script>
    </body>
</html>